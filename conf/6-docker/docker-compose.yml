#                                 #
# This is my docker compose file. #
#                                 #

version: "3.9"

# Services.
services:

    # Bazarr
    bazarr:
        container_name: bazarr
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: linuxserver/bazarr:latest
        ports:
        - "6767:6767"
        restart: ${US}
        volumes:
            - ${CONFIG}/bazarr:/config
            - /mnt/vd0/data/videos/movies:/movies
            - /mnt/vd0/data/videos/series:/tv

    # Bitwarden
    bitwarden:
        container_name: bitwarden
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - LOG_FILE=/data/bitwarden.log
            - SIGNUPS_ALLOWED=true
        image: bitwardenrs/server:latest
        ports:
            - "8000:80"
        restart: ${US}
        volumes:
            - ${CONFIG}/bitwarden:/data:rw

    # Bookstack
    bookstack:
        container_name: bookstack
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - APP_URL=${BKSTCK_APP_URL}
            - DB_HOST=${BKSTCK_DB_HOST}
            - DB_USER=${BKSTCK_DB_USER}
            - DB_PASS=${BKSTCK_DB_PASS}
            - DB_DATABASE=${BKSTCK_DB_DATABASE}
        image: linuxserver/bookstack:latest
        ports:
            - "6875:80"
        restart: ${US}
        volumes:
            - ${CONFIG}/bookstack:/config:rw

    # Factorio
    # factorio:
    #     container_name: factorio
    #     environment:
    #         - PUID=${UID}
    #         - PGID=${GID}
    #     image: factoriotools/factorio:stable
    #     ports:
    #         - "34198:34198/udp"
    #         - "27016:27016"
    #     restart: ${US}
    #     volumes:
    #         - ${CONFIG}/factorio:/factorio:rw
    
    # Factorio 2
    factorio2:
        container_name: factorio2
        environment:
            - PUID=${UID}
            - PGID=${GID}
        image: factoriotools/factorio:stable
        ports:
            - "34197:34197/udp"
            - "27015:27015"
        restart: ${US}
        volumes:
            - ${CONFIG}/factorio2:/factorio:rw

    # Firefly
    firefly:
        container_name: firefly
        environment:
            - PUID=${UID}
            - GUID=${GID}
            - TZ=${TZ}
            - APP_KEY=${FRFL_APP_KEY}
            - DB_CONNECTION=${FRFL_DB_CONNECTION}
            - DB_HOST=${FRFL_DB_HOST}
            - DB_PORT=${FRFL_DB_PORT}
            - DB_DATABASE=${FRFL_DB_DATABASE}
            - DB_USERNAME=${FRFL_DB_USERNAME}
            - DB_PASSWORD=${FRFL_DB_PASSWORD}
        image: fireflyiii/core:latest
        ports:
            - "8082:8080"
        restart: ${US}
        volumes:
            - ${CONFIG}/firefly/upload:/var/www/html/storage/upload

    #Firefly Data Importer
    firefly-di:
        container_name: firefly-di
        environment:
            - PUID=${UID}
            - GUID=${GID}
            - TZ=${TZ}
            - FIREFLY_III_ACCESS_TOKEN=${FRFL_ACCESS_TOKEN}
            - NORDIGEN_ID=${FRFL_NRDGN_ID}
            - NORDIGEN_KEY=${FRFL_NRDGN_KEY}
        image: fireflyiii/data-importer:latest
        ports:
            - "8083:8080"
        restart: ${US}

    # Frigate
    frigate:
        container_name: frigate
        devices:
            # - /dev/bus/usb:/dev/bus/usb # usb coral
            - /dev/dri/renderD128
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - FRIGATE_RTSP_PASSWORD=${FRIGATE_RTSP_PW}
        image: blakeblackshear/frigate:stable-amd64
        ports:
            - "5000:5000"
            - "1935:1935"
        privileged: true
        restart: ${US}
        shm_size: "64mb"
        volumes:
            - /etc/localtime:/etc/localtime:ro
            - ${CONFIG}/frigate/config.yml:/config/config.yml
            - /home/alex/frigate/storage:/media/frigate

    # Gitea
    gitea:
        container_name: gitea
        environment:
            - USER_UID=${UID}
            - USER_GID=${GID}
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - DB_TYPE={GITEA_DB_TYPE}
            - DB_HOST=${GITEA_DB_HOST}
            - DB_NAME=${GITEA_DB_DATABASE}
            - DB_USER=${GITEA_DB_USERNAME}
            - DB_PASSWD=${GITEA_DB_PASSWORD}
        image: gitea/gitea:latest
        ports:
            - "3000:3000"
            - "222:22"
        restart: ${US}
        volumes:
            - ${CONFIG}/gitea:/data
            - /etc/timezone:/etc/timezone:ro
            - /etc/localtime:/etc/localtime:ro
    
    # Grocy
    grocy:
        container_name: grocy
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: linuxserver/grocy
        ports:
            - "9283:80"
        restart: ${US}
        volumes:
            - ${CONFIG}/grocy:/config

    # Homer
    homer:
        container_name: homer
        environment:
            - PUID=${UID}
            - GUID=${GID}
            - TZ=${TZ}
        image: b4bz/homer:latest
        ports:
            - "9009:8080"
        restart: ${US}
        volumes:
            - ${CONFIG}/homer/assets:/www/assets

    immich-server:
        container_name: immich-server
        depends_on:
            - immich-db
        entrypoint: ["/bin/sh", "./start-server.sh"]
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - NODE_ENV=production
            - REDIS_HOSTNAME=${IMMICH_REDIS_HOST}
            - DB_HOSTNAME=${IMMICH_DB_HOST}
            - DB_DATABASE_NAME=${IMMICH_DB_NAME}
            - DB_PASSWORD=${IMMICH_DB_PASSWD}
            - DB_USERNAME=${IMMICH_DB_USER}
            - ENABLE_MAPBOX=false
            - JWT_SECRET=${IMMICH_JWT}
        image: altran1502/immich-server:release
        restart: ${US}
        volumes:
            - ${CONFIG}/../../uploads/immich:/usr/src/app/upload
    immich-microservices:
        container_name: immich-microservices
        depends_on:
            - immich-db
        entrypoint: ["/bin/sh", "./start-microservices.sh"]
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - NODE_ENV=production
            - REDIS_HOSTNAME=${IMMICH_REDIS_HOST}
            - DB_HOSTNAME=${IMMICH_DB_HOST}
            - DB_DATABASE_NAME=${IMMICH_DB_NAME}
            - DB_PASSWORD=${IMMICH_DB_PASSWD}
            - DB_USERNAME=${IMMICH_DB_USER}
            - ENABLE_MAPBOX=false
            - JWT_SECRET=${IMMICH_JWT}
            - VITE_LOGIN_PAGE_MESSAGE=welkom
        image: altran1502/immich-server:release
        restart: ${US}
        volumes:
            - ${CONFIG}/../../uploads/immich:/usr/src/app/upload
    immich-ml:
        container_name: immich-ml
        depends_on:
            - immich-db
        entrypoint: ["/bin/sh", "./entrypoint.sh"]
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - NODE_ENV=production
            - REDIS_HOSTNAME=${IMMICH_REDIS_HOST}
            - DB_HOSTNAME=${IMMICH_DB_HOST}
            - DB_DATABASE_NAME=${IMMICH_DB_NAME}
            - DB_PASSWORD=${IMMICH_DB_PASSWD}
            - DB_USERNAME=${IMMICH_DB_USER}
            - ENABLE_MAPBOX=false
            - JWT_SECRET=${IMMICH_JWT}
        image: altran1502/immich-machine-learning:release
        restart: ${US}
        volumes:
            - ${CONFIG}/../../uploads/immich:/usr/src/app/upload
    immich-web:
        container_name: immich-web
        entrypoint: ["/bin/sh", "./entrypoint.sh"]
        image: altran1502/immich-web:release
        restart: ${US}
    immich-db:
        container_name: immich-db
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - POSTGRES_HOSTNAME=${IMMICH_DB_HOST}
            - POSTGRES_PASSWORD=${IMMICH_DB_PASSWD}
            - POSTGRES_USER=${IMMICH_DB_USER}
            - POSTGRES_DB=${IMMICH_DB_NAME}
            - PG_DATA=/var/lib/postgresql/data
        image: postgres:14
        restart: ${US}
        volumes:
            - ${CONFIG}/immich/pgdata:/var/lib/postgresql/data
    immich-proxy:
        container_name: immich-proxy
        depends_on:
            - immich-server
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: altran1502/immich-proxy:release
        ports:
            - "2283:80"
        restart: ${US}
    
    # MotionEye
    motioneye:
        container_name: motioneye
        environment:
            - PUID=${UID}
            - GUID=${GID}
            - TIMEZONE=${TZ}
        hostname: motioneye
        image: jshridha/motioneye:latest
        ports:
            - "8765:8765"
        restart: ${US}
        volumes:
            - ${CONFIG}/motioneye:/config:rw

    # Nextcloud
    nextcloud:
        container_name: nextcloud
        environment:
            - PUID=${UID}
            - GUID=${GID}
            - TZ=${TZ}
            - MYSQL_PASSWORD=${NXTCLD_DB_PW}
            - MYSQL_DATABASE=${NXTCLD_DB_NAME}
            - MYSQL_USER=${NXTCLD_DB_U}
            - MYSQL_HOST=${NXTCLD_DB_HOST}
            - NEXTCLOUD_ADMIN_USER=${NXTCLD_A_U}
            - NEXTCLOUD_ADMIN_PASSWORD=${NXTCLD_A_PW}
            - REDIS_HOST=${NXTCLD_REDIS_HOST}
        image: linuxserver/nextcloud:latest
        ports:
            - "3333:443"
        restart: ${US}
        volumes:
            - ${CONFIG}/nextcloud:/config
            - /media/nextcloud/data:/data
            - /mnt/vd0/data/nextcloud:/mrgrfsdata

    # Nginx proxy manager
    nginx-proxy-manager:
        container_name: nginx-proxy-manager
        environment:
            - PUID=${UID}
            - GUID=${GID}
            - TZ=${TZ}
            - DB_MYSQL_HOST=${NPM_DB_HOST}
            - DB_MYSQL_PORT=${NPM_DB_PORT}
            - DB_MYSQL_USER=${NPM_DB_USER}
            - DB_MYSQL_PASSWORD=${NPM_DB_PW}
            - DB_MYSQL_NAME=${NPM_DB_NAME}
        image: jc21/nginx-proxy-manager:latest
        ports:
            - "8181:81"
            - "8081:80"
            - "4443:443"
        restart: ${US}
        volumes:
            - ${CONFIG}/nginx-proxy-manager/config:/app/config:rw
            - ${CONFIG}/nginx-proxy-manager/data:/data:rw
            - ${CONFIG}/nginx-proxy-manager/letsencrypt:/etc/letsencrypt:rw

    # Ouroboros
    ouroboros:
        container_name: ouroboros
        environment:
            - CLEANUP=true
            - CRON=0 4 * * *
            - LOG_LEVEL=info
            - SELF_UPDATE=true
            - IGNORE=mariadb
            - NOTIFIERS=${OUROBOROS_NOTIFIERS}
            - TZ=${TZ}
        image: pyouroboros/ouroboros:latest
        restart: ${US}
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock

    # Plex
    plex:
        container_name: plex
        devices:
            - "/dev/dri:/dev/dri"
        environment:
            - ADVERTISE_IP=http://192.168.1.111:32400/
            - PLEX_UID=${UID}
            - PLEX_GID=${GID}
            - TZ=${TZ}
            - PLEX_CLAIM=${PLEX_CLAIM}
            - NVIDIA_DRIVER_CAPIBILITIES=compute,video,utility
            - NVIDIA_VISIBLE_DEVICES=all
        image: plexinc/pms-docker:latest
        ports:
            - "32400:32400"
        restart: ${US}
        volumes:
            - ${CONFIG}/plex:/config:rw
            - /home/alex/downloads/plex/transcode:/transcode:rw
            - /mnt/vd0/data/videos:/data:rw
        
    # Photoprism
    photoprism:
        container_name: photoprism
        devices:
            - "/dev/dri/renderD128:/dev/dri/renderD128"
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - PHOTOPRISM_ADMIN_PASSWORD=${PHOTO_ADMIN_PW}
            - PHOTOPRISM_ORIGINALS_LIMIT=00
            - PHOTOPRISM_HTTP_COMPRESSION=gzip
            - PHOTOPRISM_DEBUG=false
            - PHOTOPRISM_PUBLIC=false
            - PHOTOPRISM_READONLY=false
            - PHOTOPRISM_EXPERIMENTAL=false
            - PHOTOPRISM_DISABLE_CHOWN=false
            - PHOTOPRISM_DISABLE_WEBDAV=false
            - PHOTOPRISM_DISABLE_SETTINGS=false
            - PHOTOPRISM_DISABLE_TENSORFLOW=false
            - PHOTOPRISM_DISABLE_FACES=false
            - PHOTOPRISM_DISABLE_CLASSIFICATION=false
            - PHOTOPRISM_DARKTABLE_PRESETS=false
            - PHOTOPRISM_DETECT_NSFW=true
            - PHOTOPRISM_UPLOAD_NSFW=true
            - PHOTOPRISM_DATABASE_DRIVER=mysql
            - PHOTOPRISM_DATABASE_SERVER=${PHOTO_DB_HOST}
            - PHOTOPRISM_DATABASE_NAME=${PHOTO_DB_NAME}
            - PHOTOPRISM_DATABASE_USER=${PHOTO_DB_U}
            - PHOTOPRISM_DATABASE_PASSWORD=${PHOTO_DB_PW}
            - PHOTOPRISM_SITE_URL=http://192.168.1.111:2342/
            - PHOTOPRISM_SITE_TITLE=PhotoPrism
            - PHOTOPRISM_SITE_CAPTION=Browse Your Life
            - PHOTOPRISM_SITE_DESCRIPTION=Fotoooo's
            - PHOTOPRISM_SITE_AUTHOR=Alex de Wekker
            - PHOTOPRISM_UID=${UID}
            - PHOTOPRISM_GID=${GID}
            - PHOTOPRISM_UMASK=0000
            - PHOTOPRISM_INIT=tensorflow-amd64-avx2
            - PHOTOPRISM_FFMPEG_BUFFERS=64
            - PHOTOPRISM_FFMPEG_BITRATE=64
            - PHOTOPRISM_FFMPEG_ENCODER=h264_qsv
            - PHOTOPRISM_INIT=intel-graphics tensorflow-amd64-avx2
            - HOME=/mnt/vd0/data/nextcloud/photos/photoprism
        image: photoprism/photoprism:latest
        restart: ${US}
        ports:
            - "2342:2342"
        volumes:
            - "/mnt/vd0/data/nextcloud/photos:/photoprism/originals:rw"
            - "${CONFIG}/photoprism:/photoprism/storage:rw"
        working_dir: "/mnt/vd0/data/nextcloud/photos/photoprism"
 
    # Portainer
    portainer:
        command: -H unix:///var/run/docker.sock
        container_name: portainer
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: portainer/portainer-ce:latest
        ports:
            - "9000:9000"
        restart: ${US}
        volumes:
            - ${CONFIG}/portainer:/data:rw
            - /etc/localtime:/etc/localtime:ro
            - /home/alex/.docker/shared:/shared:rw
            - /var/run/docker.sock:/var/run/docker.sock:rw

    # Prowlarr
    prowlarr:
        container_name: prowlarr
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: linuxserver/prowlarr:develop
        ports:
            - "9696:9696"
        restart: ${US}
        volumes:
            - ${CONFIG}/prowlarr:/config:rw

    # QBittorrentVPN
    qbittorrentvpn:
        container_name: qbittorrentvpn
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - VPN_ENABLED=yes
            - VPN_USERNAME=${VPN_USERNAME}
            - VPN_PASSWORD=${VPN_PASSWORD}
            - LAN_NETWORK=192.168.1.0/24
            - NAME_SERVERS=192.168.1.90,1.1.1.1
        image: markusmcnugen/qbittorrentvpn:latest
        ports:
            - "8080:8080"
            - "8999:8999"
            - "8999:8999/udp"
        privileged: true
        restart: ${US}
        volumes:
            - ${CONFIG}/qbittorrent:/config:rw
            - /home/alex/downloads/qbittorrentvpn:/downloads:rw

    # Radarr
    radarr:
        container_name: radarr
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: linuxserver/radarr:nightly
        ports:
            - "7878:7878"
        restart: ${US}
        volumes:
            - ${CONFIG}/radarr:/config:rw
            - /mnt/vd0/data/videos:/movies:rw
            - /home/alex/downloads/qbittorrentvpn:/downloads:rw

    # Scrutiny
    scrutiny:
        cap_add:
            - SYS_RAWIO
        container_name: scrutiny
        devices:
            - /dev/sda:/dev/sda
            - /dev/sdb:/dev/sdb
            - /dev/sdc:/dev/sdc
            - /dev/sdd:/dev/sdd
            - /dev/sde:/dev/sde
            - /dev/sdf:/dev/sdf
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: ghcr.io/analogj/scrutiny:master-omnibus
        ports:
            - "8088:8080"
            - "8086:8086"
        restart: ${US}
        volumes:
            - ${CONFIG}/scrutiny:/opt/scrutiny/config
            - ${CONFIG}/scrutiny/influxdb2:/opt/scrutiny/influxdb
            - /run/udev:/run/udev:ro

    # Sky Factory
    # skyfactory:
    #     container_name: skyfactory
    #     environment:
    #         - PUID=${UID}
    #         - PGID=${GID}
    #         - TZ=${TZ}
    #         # - SERVER_OP=Niles018
    #     image: cochief/skyfactory4
    #     ports:
    #         - "25566:25565"
    #     restart: ${US}
    #     volumes:
    #         - ${CONFIG}/skyfactory/world:/minecraft/world
    #         - ${CONFIG}/skyfactory/ops.json:/minecraft/ops.json
    #         - ${CONFIG}/skyfactory/server.properties:/minecraft/server.properties
    #         - ${CONFIG}/skyfactory/whitelist.json:/minecraft/whitelist.json

    # Sonarr
    sonarr:
        container_name: sonarr
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
        image: linuxserver/sonarr:latest
        ports:
            - "8989:8989"
        restart: ${US}
        volumes:
            - ${CONFIG}/sonarr:/config:rw
            - /mnt/vd0/data/videos:/tv:rw
            - /home/alex/downloads/qbittorrentvpn:/downloads:rw

    # Tautulli
    tautulli:
        container_name: tautulli
        environment:
            - PUID=${UID}
            - GUID=${GID}
            - TZ=${TZ}
        image: tautulli/tautulli:latest
        ports:
            - "8182:8181"
        restart: ${US}
        volumes:
            - ${CONFIG}/tautulli:/config:rw
            - ${CONFIG}/plex/Library/Application Support/Plex Media Server/Logs:/plex_logs:ro
    
    # Tdarr
    tdarr:
        container_name: tdarr
        devices:
            - "/dev/dri:/dev/dri"
        environment:
            - PUID=${UID}
            - PGID=${GID}
            - TZ=${TZ}
            - serverIP=192.168.1.111
            - serverPort=8266
            - webUIPort=8265
            - internalNode=true
            - nodeID=SergeNode
        image: haveagitgat/tdarr:latest
        ports:
            - "8265:8265"
            - "8266:8266"
            - "8267:8267"
        restart: ${US}
        volumes:
            - ${CONFIG}/tdarr/server:/app/server
            - ${CONFIG}/tdarr/configs:/app/configs
            - ${CONFIG}/tdarr/logs:/app/logs
            - /mnt/vd0/data:/media
            - ${CONFIG}/../../downloads/tdarr/cache:/temp
    
    # Tekkit
    # tekkit:
    #     container_name: tekkit
    #     environment:
    #         - PUID=${UID}
    #         - GUID=${GID}
    #         - TZ=${TZ}
    #         # - SERVER_OP=Niles018
    #     image: dang1t/tekkit-classic-docker:latest
    #     ports:
    #         - "25565:25565"
    #     restart: ${US}
    #     volumes:
    #         - ${CONFIG}/tekkit-server/world:/minecraft/world
    #         - ${CONFIG}/tekkit-server/world_nether:/minecraft/world_nether
    #         - ${CONFIG}/tekkit-server/world_the_end:/minecraft/world_the_end
    #         - ${CONFIG}/tekkit-server/plugins:/minecraft/plugins
    
    # Valheim
    # valheim-server:
    #     container_name: valheim-server
    #     environment:
    #         - PUID=${UID}
    #         - PGID=${GID}
    #         - TZ=${TZ}
    #         - SERVER_NAME=Kloenkerserver
    #         - WORLD_NAME=Kloenkeraarde
    #         - SERVER_PASS=Kloenker1
    #     image: lloesche/valheim-server
    #     ports:
    #         - "2456-2458:2456-2458/udp"
    #     restart: ${US}
    #     volumes:
    #         - ${CONFIG}/valheim:/config
